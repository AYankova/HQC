#     Поведенчески шаблони за дизайн
##    Memento Pattern
### Цел на шаблона
* Шаблонът "Мементо" (Memento) описва как бихме могли да запазим вътрешното състояние на един обект и как по-късно да го върнем в това състояние, без да нарушаваме капсулирането на обекта.

### Проблем
* В софтуерните системи често се налага състоянието на даден обект да бъде запазено под някаква форма, с цел последствие обектът да може да се възвърне към него. Това не винаги е тривиално, тъй като понякога част от вътрешното състояние на обекта не е достъпно през публичния му интерфейс. Разбира се, проблемът лесно би могъл да бъде решен чрез разширяването на този интерфейс, но това би нарушило принципа за капсулиране на данните, водейки до повишаване на сложността на системата. В подобна ситуация можем да приложим шаблона "Мементо" (Memento), който ще ни позволи да извлечем вътрешното състояние в нов обект, удобен за съхранение.

### Приложимост
Използваме шаблонa "Мементо" (Memento) когато:

* искаме да запазим вътрешното състояние на обект (или част от него) така, че по-късно да можем да приведем обекта обратно до съхраненото състояние 
* не искаме да разкриваме детайли от вътрешното състояние на обекта само с цел съхраняването му (с други думи не искаме да нарушаваме капсулирането му).

### Участници
* Създател (Originator) – класът, чието вътрешно състояние ни е необходимо да запазим, без да разкриваме детайли от вътрешната му имплементация. 
* Мементо (Memento) – класът, капсулиращ данни за вътрешното състояние на създателя, и който би могъл да се използва за възстановяване на дадено негово състояние. Дефинира два интерфейса – един за съхранение и един за модификация, като последният е достъпен единствено за създателя.
* Пазител (Caretaker) – класът, който съхранява обектите Мементо, създадени при запазване на състояния на създателя. Ползва единствено интерфейса за съхранение на Мементо и не може да го модифицира. 

### Оценка на шаблона
* Запазване на капсулирането на обекта (създателя) е основната причина да ползваме шаблона "Мементо" (Memento). Промени във вътрешната имплементация на създателя евентуално биха довели само до промени в Мементо (който в общият случай е сравнително прост клас), но не и до такива в пазителя, или в останалите части на системата.
* Създателят се опростява като клас, тъй като логиката по управлението на съхранението на състоянието (т.е. на обектите Мементо) се отделя в друг клас – пазителя. В допълнение, по този начин изолираме механизма за запаметяване/възстановяване на състоянието от промени в имплементацията на създателя.
* В зависимост от размера на обектите от тип Мементо и стратегията за съхраняването им, използването на шаблона може да доведе до заемане на голямо количество памет, което е потенциален проблем – особено ако за съхранение се използва RAM паметта.
* Ако за създаването на Мементо са необходими голям брой входно-изходни операции и/или процесорно време, това би могло да доведе до проблеми с производителността.
* Дефинирането (в Мементо) на втори интерфейс, достъпен само за определен клас (създателя), може да е трудно и дори невъзможно в някои езици за програмиране.

### Познати приложения
__Undo/Redo__

* Едно от най-често срещаните приложения на шаблона е – в комбинация с шаблона "Команда" (Command) – за запазване на история на изпълнените команди в текстови и графични редактори, по този начин позволявайки поддръжка на функциите "отмяна" (undo) и "преизпълнение" (redo). Състоянието на редактора се запаметява в Мементо преди изпълнението на всяка команда; така, ако потребителят отмени последното си действие, средата може да се възстанови към момента преди изпълнението му.

__Запис (save) при компютърни игри__

* Друго приложение е при запазване на състоянието на различни софтуерни приложения – например компютърни игри (още популярно като Save). Докато за операционната система обектът, съдържащ запаметеното състояние, е просто файл, то за компютърната игра е възможно да възстанови състоянието на виртуалния си свят към даден момент благодарение на информацията записана в него.

__HTTP-бисквитки__

* Друг пример за Мементо, макар и по-абстрактен, са HTTP-бисквитките (HTTP cookies). При посещение на даден уебсайт, те пазят информация за текущата сесия на потребителя. Впоследствие, при всяко завръщане към уебсайта, тази информация може да бъде използвана за възстановяване на част от предишното състоянието – например дали потребителят е влязъл в профила си (logged in), дали е добавил продукти в кошницата си и т.н.


### Свързани шаблони
* "Команда" (Command) – често се използва с "Мементо" (Memento), когато е необходимо да се поддържа история на изпълнените команди. Използвайки запазената в Мементо класа информация, приложението би могло да се завърне към предишно състояние с цел отмяна/преизпълнение на последната изпълнена команда.
* "Итератор" (Iterator) – итераторът би могъл да използва вътрешно Мементо, за да съхрани текущото състояние, в което се намира итерираният обект спрямо него – например текущ елемент, посока на движение и т.н. Предимството на този подход е, че по този начин итерираният обект би могъл да поддържа множество активни итератори върху себе си.




